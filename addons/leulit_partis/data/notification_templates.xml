<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Plantilla de email para riesgos pendientes de aprobaci贸n -->
    <record id="email_template_pending_approval_risks" model="mail.template">
        <field name="name">Alerta: Riesgos Pendientes de Aprobaci贸n</field>
        <field name="model_id" ref="model_mgmtsystem_notification_cron"/>
        <field name="subject">Alerta SGSI: ${object.risk_count} riesgos pendientes de aprobaci贸n</field>
        <field name="email_from">${(object.env.company.email or 'noreply@example.com')}</field>
        <field name="body_html" type="html">
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                <div style="background-color: #ff9800; color: white; padding: 20px; text-align: center;">
                    <h2 style="margin: 0;">锔 Alerta SGSI - Riesgos Pendientes</h2>
                </div>
                
                <div style="padding: 20px; background-color: #f9f9f9;">
                    <p>Estimado/a usuario/a,</p>
                    
                    <p>Existen <strong>${object.risk_count}</strong> an谩lisis de riesgos pendientes de aprobaci贸n 
                    con m谩s de <strong>${object.days_threshold}</strong> d铆as de antig眉edad:</p>
                    
                    <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                        <thead>
                            <tr style="background-color: #e0e0e0;">
                                <th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Activo</th>
                                <th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Amenaza</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #ccc;">Nivel</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #ccc;">D铆as</th>
                            </tr>
                        </thead>
                        <tbody>
                            % for risk in object.risk_list[:10]:
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ccc;">${risk['asset']}</td>
                                <td style="padding: 8px; border: 1px solid #ccc;">${risk['threat']}</td>
                                <td style="padding: 8px; text-align: center; border: 1px solid #ccc;">
                                    <span style="color: ${'red' if risk['level'] >= 4 else ('orange' if risk['level'] == 3 else 'green')}; font-weight: bold;">
                                        ${risk['level']}
                                    </span>
                                </td>
                                <td style="padding: 8px; text-align: center; border: 1px solid #ccc;">${risk['days_pending']}</td>
                            </tr>
                            % endfor
                        </tbody>
                    </table>
                    
                    % if object.risk_count > 10:
                    <p><em>Mostrando los primeros 10 registros de ${object.risk_count} totales.</em></p>
                    % endif
                    
                    <p style="margin-top: 20px;">
                        <strong>Acci贸n requerida:</strong> Por favor, revise y apruebe/rechace estos planes de tratamiento 
                        accediendo al m贸dulo SGSI PART-IS.
                    </p>
                    
                    <div style="text-align: center; margin: 30px 0;">
                        <a href="${object.env['ir.config_parameter'].sudo().get_param('web.base.url')}/web#action=leulit_partis.action_mgmtsystem_risk&amp;menu_id=leulit_partis.menu_mgmtsystem_risk" 
                           style="background-color: #ff9800; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; display: inline-block;">
                            Ver Riesgos Pendientes
                        </a>
                    </div>
                </div>
                
                <div style="padding: 15px; background-color: #e0e0e0; text-align: center; font-size: 12px; color: #666;">
                    <p>Sistema de Gesti贸n de Seguridad de la Informaci贸n (SGSI) - PART-IS<br/>
                    Notificaci贸n autom谩tica - No responder a este correo</p>
                </div>
            </div>
        </field>
    </record>

    <!-- Plantilla de email para riesgos cr铆ticos sin tratamiento -->
    <record id="email_template_critical_risks" model="mail.template">
        <field name="name">Alerta: Riesgos Cr铆ticos sin Tratamiento</field>
        <field name="model_id" ref="model_mgmtsystem_notification_cron"/>
        <field name="subject">Alerta SGSI: ${object.risk_count} riesgos cr铆ticos requieren atenci贸n inmediata</field>
        <field name="email_from">${(object.env.company.email or 'noreply@example.com')}</field>
        <field name="body_html" type="html">
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                <div style="background-color: #d32f2f; color: white; padding: 20px; text-align: center;">
                    <h2 style="margin: 0;"> Alerta CRTICA SGSI</h2>
                </div>
                
                <div style="padding: 20px; background-color: #f9f9f9;">
                    <p>Estimado/a usuario/a,</p>
                    
                    <p>Se han detectado <strong style="color: #d32f2f;">${object.risk_count}</strong> riesgos de nivel 
                    <strong>ALTO/CRTICO</strong> que no tienen un plan de tratamiento aprobado:</p>
                    
                    <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                        <thead>
                            <tr style="background-color: #ffcdd2;">
                                <th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Activo</th>
                                <th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Amenaza</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #ccc;">Nivel</th>
                                <th style="padding: 10px; text-align: left; border: 1px solid #ccc;">Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            % for risk in object.risk_list[:10]:
                            <tr>
                                <td style="padding: 8px; border: 1px solid #ccc;">${risk['asset']}</td>
                                <td style="padding: 8px; border: 1px solid #ccc;">${risk['threat']}</td>
                                <td style="padding: 8px; text-align: center; border: 1px solid #ccc;">
                                    <span style="color: red; font-weight: bold; font-size: 1.2em;">
                                        ${risk['level']}
                                    </span>
                                </td>
                                <td style="padding: 8px; border: 1px solid #ccc;">${risk['state']}</td>
                            </tr>
                            % endfor
                        </tbody>
                    </table>
                    
                    % if object.risk_count > 10:
                    <p><em>Mostrando los primeros 10 registros de ${object.risk_count} totales.</em></p>
                    % endif
                    
                    <div style="background-color: #ffebee; border-left: 4px solid #d32f2f; padding: 15px; margin: 20px 0;">
                        <strong>锔 ACCIN INMEDIATA REQUERIDA:</strong>
                        <ul style="margin: 10px 0;">
                            <li>Estos riesgos representan una amenaza significativa para la seguridad de la informaci贸n</li>
                            <li>Se requiere definir e implementar un plan de tratamiento con car谩cter urgente</li>
                            <li>Cumplimiento PART-IS y normativa AESA en riesgo</li>
                        </ul>
                    </div>
                    
                    <div style="text-align: center; margin: 30px 0;">
                        <a href="${object.env['ir.config_parameter'].sudo().get_param('web.base.url')}/web#action=leulit_partis.action_mgmtsystem_risk&amp;menu_id=leulit_partis.menu_mgmtsystem_risk" 
                           style="background-color: #d32f2f; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; display: inline-block;">
                            Ver Riesgos Cr铆ticos
                        </a>
                    </div>
                </div>
                
                <div style="padding: 15px; background-color: #e0e0e0; text-align: center; font-size: 12px; color: #666;">
                    <p>Sistema de Gesti贸n de Seguridad de la Informaci贸n (SGSI) - PART-IS<br/>
                    Notificaci贸n autom谩tica - No responder a este correo</p>
                </div>
            </div>
        </field>
    </record>
</odoo>
